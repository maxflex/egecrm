// Generated by CoffeeScript 1.9.3
angular.module("Testing", []).filter('range', function() {
  return function(input, total) {
    var i, j, ref;
    total = parseInt(total);
    for (i = j = 1, ref = total + 1; j < ref; i = j += 1) {
      input.push(i);
    }
    return input;
  };
}).controller("ListCtrl", function($scope) {
  return angular.element(document).ready(function() {
    return set_scope("Testing");
  });
}).controller("AddCtrl", function($scope) {
  $scope.formatDay = function(date) {
    var day, month;
    day = moment(date).format("ddd");
    month = moment(date).format(", DD MMMM");
    return day.toUpperCase() + month;
  };
  $scope.subjectChecked = function(grade, id_subject) {
    var arr;
    if (grade === 11) {
      arr = $scope.Testing.subjects_11;
    } else {
      arr = $scope.Testing.subjects_9;
    }
    return $.inArray(parseInt(id_subject), arr) >= 0;
  };
  $scope.changeDate = function() {
    return $.post("testing/ajaxChangeDate", {
      id: $scope.Testing.id,
      date: $scope.Testing.date
    }, function(response) {
      $scope.cabinet_load = response;
      return $scope.$apply();
    }, "json");
  };
  $scope.notEnoughTime = function(minutes) {
    var date_end, date_start, minutes_end, minutes_start;
    if (!$scope.Testing || !$scope.Testing.start_time || !$scope.Testing.end_time) {
      return true;
    }
    date_start = new Date('2015-09-01 ' + $scope.Testing.start_time);
    date_end = new Date('2015-09-01 ' + $scope.Testing.end_time);
    minutes_start = (date_start.getHours() * 60) + date_start.getMinutes();
    minutes_end = (date_end.getHours() * 60) + date_end.getMinutes();
    return (minutes_end - minutes_start) < minutes;
  };
  $scope.saveTesting = function() {
    return $.post("testing/ajaxSave", {
      Testing: $scope.Testing
    }, function(response) {
      return console.log(response);
    }, "json");
  };
  $scope.addTesting = function() {
    ajaxStart();
    return $.post("testing/ajaxAdd", {
      Testing: $scope.Testing
    }, function(response) {
      console.log(response);
      return redirect("testing/");
    }, "json");
  };
  return angular.element(document).ready(function() {
    if ($scope.Testing !== void 0) {
      $scope.changeDate();
    }
    return set_scope("Testing");
  });
});
