<?php	// Контроллер	class TendencyController extends Controller	{		public $defaultAction = "index";		public static $allowed_users = [User::USER_TYPE, Teacher::USER_TYPE, Student::USER_TYPE];		// Папка вьюх		protected $_viewsFolder	= "tendency";		public function actionIndex()		{			$this->setTabTitle("Тенденции");            $this->addJs('ng-tendency-app');            $this->render('index');            $ang_init_data = angInit([                "Subjects" 		=> Subjects::$three_letters,                "Grades"		=> Grades::$all,                "GroupLevels"	=> GroupLevels::$short,                "Branches"		=> Branches::$all,            ]);            $this->render("index", [                "ang_init_data" => $ang_init_data            ]);		}        public function actionAjaxSearch()        {            extract($_POST['search']);            if (isset($subjects)) {                $subjects_condition = [];                foreach($subjects as $id_subject) {                    $subjects_condition[] = "FIND_IN_SET({$id_subject}, subjects)";                }            }            if (isset($grades)) {                $grades_condition = [];                foreach($grades as $grade) {                    $grades_condition[] = "grade={$grade}";                }            }            if (isset($branches)) {                $branches_condition = [];                foreach($branches as $id_branch) {                    $branches_condition[] = "FIND_IN_SET({$id_branch}, branches)";                }            }            $query = dbConnection()->query("SELECT COUNT(*) as cnt FROM requests WHERE adding=0 AND date>='2016-05-01' "                . (isset($subjects) ? ' AND (' . implode(' OR ', $subjects_condition) . ')' : "")                . (isset($grades) ? ' AND (' . implode(' OR ', $grades_condition) . ')' : "")                . (isset($branches) ? ' AND (' . implode(' OR ', $branches_condition) . ')' : ""));            returnJsonAng($query->fetch_object()->cnt);        }	}