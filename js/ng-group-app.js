// Generated by CoffeeScript 1.9.3
var indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

angular.module("Group", []).controller("EditCtrl", function($scope) {
  $scope.countSubjects = function(Contract) {
    return Object.keys(Contract.subjects).length;
  };
  $scope.addStudent = function(id_student) {
    if (indexOf.call($scope.Group.students, id_student) < 0) {
      $scope.Group.students.push(id_student);
      return $scope.form_changed = true;
    }
  };
  $scope.removeStudent = function(id_student) {
    return $.each($scope.Group.students, function(index, data) {
      if (data === id_student) {
        console.log(data, index);
        $scope.Group.students.splice(index, 1);
        $scope.form_changed = true;
        return $scope.$apply();
      }
    });
  };
  $scope.studentAdded = function(id_student) {
    return indexOf.call($scope.Group.students, id_student) >= 0;
  };
  $scope.getStudent = function(id_student) {
    var Student, i;
    Student = ((function() {
      var j, len, ref, results;
      ref = $scope.Students;
      results = [];
      for (j = 0, len = ref.length; j < len; j++) {
        i = ref[j];
        if (i.id === id_student) {
          results.push(i);
        }
      }
      return results;
    })())[0];
    return Student.last_name + " " + Student.first_name + " " + Student.middle_name;
  };
  $scope.search = {
    grade: "",
    id_branch: "",
    id_subject: ""
  };
  $scope.clientsFilter = function(Student) {
    var ref;
    return (Student.Contract.grade === parseInt($scope.search.grade) || !$scope.search.grade) && ((ref = parseInt($scope.search.id_branch), indexOf.call(Student.branches, ref) >= 0) || !$scope.search.id_branch) && (Student.Contract.subjects && (parseInt($scope.search.id_subject) in Student.Contract.subjects || !$scope.search.id_subject));
  };
  angular.element(document).ready(function() {
    set_scope("Group");
    return frontendLoadingEnd();
  });
  $(document).ready(function() {
    return $("#group-edit").on('keyup change', 'input, select, textarea', function() {
      $scope.form_changed = true;
      return $scope.$apply();
    });
  });
  return $(".save-button").on("click", function() {
    ajaxStart();
    $scope.saving = true;
    $scope.$apply();
    return $.post("groups/ajax/save", $scope.Group, function(response) {
      if ($scope.Group.id) {
        ajaxEnd();
        $scope.saving = false;
        $scope.form_changed = false;
        return $scope.$apply();
      } else {
        return redirect("groups/edit/" + response);
      }
    });
  });
}).controller("ListCtrl", function($scope) {});
