<?php	// Контроллер загрузок	class UploadController extends Controller	{		public $defaultAction = "AjaxUpload";				// Папка вьюх		protected $_viewsFolder	= "";				// Строка с сообщением об ошибке		const ERROR = "ERROR";				// Временная директория электронных версий договоров		const CONTRACTS_TMP_DIR = "files/contracts/tmp/";				##################################################		###################### AJAX ######################		##################################################						/**		 * Загрузка электронной версии договора.		 * 		 */		public function actionAjaxContract() 		{//			preType($_FILES["contract_file"]);			extract($_FILES);			// Получаем временное имя файла на сервере //			$tmp_filename = $contract_file['tmp_name'];						// если есть временное имя файла (файл загрузился)/*			if ($contract_file) {				toJson([					"file_data" 	=> json_encode($contract_file),					"uploaded_file"	=> $contract_file["name"],				]);			} else {				toJson(self::ERROR);			}*/			$handle = new upload($contract_file);						if ($handle->uploaded) {				$handle->file_overwrite = true;								// Временный файл//				$handle->file_new_name_ext = 'tmp';								// Даем временное уникальное имя файлу				$handle->file_new_name_body = uniqid("contract_", true);				//				$contract_file["tmp_name"] = BASE_ROOT.self::CONTRACTS_TMP_DIR.$handle->file_new_name_body.".".$handle->file_new_name_ext;												$handle->process(self::CONTRACTS_TMP_DIR);												if ($handle->processed) {					toJson([						"file" 			=> $handle->file_dst_name,						"uploaded_file"	=> $contract_file["name"],					]);				} else {					toJson(self::ERROR);				}			} else {				toJson(self::ERROR);			}		}				public function actionAjaxUpload()		{			preType($_FILES);						if($_FILES) {							    $_FILES = $_FILES["files"];			    $file_name 	= $_FILES['name'][0];			    $file_size 	= $_FILES['size'][0];			    $file_tmp 	= $_FILES['tmp_name'][0];			    $file_type	= $_FILES['type'][0];   			   			    $file_ext=strtolower(end(explode('.', $file_name)));			    echo "FILENAME=$file_name";			    echo $file_ext;			    			    $extensions = array("jpeg","jpg","png");			    			    if(in_array($file_ext, $extensions ) === false){			    	$errors[]="extension not allowed, please choose a JPEG or PNG file.";			    }			    			    if($file_size > 2097152){			    	$errors[]='File size must be excately 2 MB';			    }							    			    if(empty($errors)==true) {//				    echo "<h4>".getcwd()." | $file_tmp | $file_name</h4>";			        move_uploaded_file($file_tmp,"img/".$file_name);//			        echo "Success";			    } else {			        print_r($errors);			    }			}		}			}